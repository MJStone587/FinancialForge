<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link
    rel="icon"
    type="image/x-icon"
    href="/images/favicon_io/favicon.ico"
  />
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Summary</title>
  </head>

  <% if(authCheck){ %> 
    <%- include("navbarLI") %> 
    <% } else { %> 
    <%-include("navbar") %> 
   <% } %>

  <!-- Summary Header -->
  
  <div class="summary_header">
    <h1><%= authUser %>'s <%= title %></h1>
    <p>View all income, expenses and spending habits</p>
    <img src="/images/summary.png" alt="Summary Image" />
  </div>
  <div class="allCharts">
  <div class="chartDisp1">
    <h1>Monthly Spending</h1>
   <canvas id="monthlySpending"></canvas>
  </div>
  <div class="chartDisp2">
    <h1>Major Expenses</h1>
    <canvas id="majorExpenses"></canvas>
  </div>
</div>
  <div class="summary_body">
    <!-- Summary Income List-->
    <% let total_income = 0; %> <% let balance = 0 %>
    <h1 class="summary_incomeTitle">Incomes</h1>
    <div class="summary_incomeList">
      <h3>Name</h3>
      <h3>Description</h3>
      <h3>Total</h3>
      <h3>Date</h3>
      <h3>Details</h3>
      <% for(let i = 0; i < incomes.length; i++){ %>
      <p id="summary_iName"><%= incomes[i].name %></p>
      <p id="summary_iDesc"><%= incomes[i].description %></p>
      <p id="summary_iAmt">$<%= incomes[i].amount %></p>
      <p id="summary_iDate"><%= incomes[i].date_formatted %></p>
      <a id="summary_iDet" href="/catalog/income/<%= incomes[i]._id %>">More</a>
      <% total_income += incomes[i].amount %> <% } %> <% function
      round(value,decimals) { %> <% return Number(Math.round(value +'e'+
      decimals) +'e-'+ decimals).toFixed(decimals); %> <% } %>
    </div>
    <h2 class="summary_incomeTotal">
      Income Total: $<%= round(total_income,2) %>
    </h2>

    <!--       Summary Receipts                -->
    <h1 class="summary_receiptTitle">Receipts</h1>
    <div class="summary_receiptList">
      <h3>Name</h3>
      <h3>Total</h3>
      <h3>Date</h3>
      <h3>Details</h3>
      <% for(let i = 0; i < receipts.length; i++) { %>
      <p id="summary_recName"><%= receipts[i].name %></p>
      <p>Total: <%= "$" + receipts[i].total %></p>
      <p><%= receipts[i].date_formatted %></p>
      <a href="/catalog/receipt/<%= receipts[i]._id %>">More</a>
      <% } %>
    </div>

    <% let total_receipt = 0; %> <% for(let i = 0; i < receipts.length; i++) {
    %> <% total_receipt += receipts[i].total; %> <% } %> <% function
    round(value, decimals) { %> <% return Number(Math.round(value +'e'+
    decimals) +'e-'+ decimals).toFixed(decimals); %> <% } %>

    <h2 class="summary_receiptTotal">
      Receipt Totals: $<%=round(total_receipt, 2);%>
    </h2>
  </div>
  <!--  Balance and Charts -->
  <% balance = total_income - total_receipt %>
  <h1 class="summary_balance">Balance = $<%= round(balance, 2); %></h1>
  <script>
    var ctx = document.getElementById("monthlySpending");
    var gtx = document.getElementById("majorExpenses");
    var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ["Jan", "Feb", "March","Apr","May","June", "July", "Aug", "Sept", "Oct", "Nov", "Dec"],
        datasets: [{
            label: "Spending in Dollars",
            data: [900, 500, 300, 1000, 400, 100, 412, 321, 823, 304, 458, 499],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        yAxes: {
                  beginAtZero:true
            }
    }
});
var newChart = new Chart(gtx, {
    type: 'pie',
    data: {
        labels: ["Gas", "Food", "Entertainment"],
        datasets: [{
            label: "Major Expenses",
            data: [6, 12, 23  ],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
      responsive: true,
    }
});
  </script>
  <%- include('footer') %>
</html>
